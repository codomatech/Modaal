/*!
	Modaal - accessible modals - v1.0.0 (Vanilla JS)
	Modern JavaScript version without jQuery
	by Humaan, for all humans.
	http://humaan.com
	adapted by Codoma.tech
	https://www.codoma.tech
 */
class Modaal{constructor(t={}){this.options={...Modaal.defaults,...t},this.xhr=null,this.dom=document.body,this.lastFocus=null,this.scope={is_open:!1,id:"modaal_"+Date.now()+Math.random().toString(16).substring(2),source:this.options.content_source},this.privateOptions={active_class:"is_active"},this.options.is_locked||"confirm"===this.options.type||this.options.hide_close?this.scope.close_btn="":this.scope.close_btn=`<button type="button" class="modaal-close" id="modaal-close" aria-label="${this.options.close_aria_label}"><span>${this.options.close_text}</span></button>`,"none"===this.options.animation&&(this.options.animation_speed=0,this.options.after_callback_delay=0);t=this.options.outer_controls?"outer":"inner";this.scope.prev_btn=`<button type="button" class="modaal-gallery-control modaal-gallery-prev modaal-gallery-prev-${t}" id="modaal-gallery-prev" aria-label="Previous image (use left arrow to change)"><span>Previous Image</span></button>`,this.scope.next_btn=`<button type="button" class="modaal-gallery-control modaal-gallery-next modaal-gallery-next-${t}" id="modaal-gallery-next" aria-label="Next image (use right arrow to change)"><span>Next Image</span></button>`,this.options.start_open&&this.open()}open(){if(!1!==this.options.should_open&&("function"!=typeof this.options.should_open||!1!==this.options.should_open())){switch(this.options.before_open.call(this),this.options.type){case"inline":this.createBasic();break;case"ajax":this.fetchAjax(this.options.source(null,this.scope.source));break;case"confirm":this.options.is_locked=!0,this.createConfirm();break;case"image":this.createImage();break;case"iframe":this.createIframe(this.options.source(null,this.scope.source));break;case"video":this.createVideo(this.scope.source);break;case"instagram":this.createInstagram()}this.watchEvents()}}close(){let o=document.getElementById(this.scope.id);o&&(this.options.before_close.call(this,o),this.xhr&&(this.xhr.abort(),this.xhr=null),"none"===this.options.animation?o.classList.add("modaal-start_none"):"fade"===this.options.animation?o.classList.add("modaal-start_fade"):"slide-down"===this.options.animation&&o.classList.add("modaal-start_slide_down"),setTimeout(()=>{if("inline"===this.options.type&&"string"==typeof this.scope.source){var t=document.querySelector(`#${this.scope.id} .modaal-content-container`),e=document.querySelector(this.scope.source);if(t&&e)for(;t.firstChild;)e.appendChild(t.firstChild)}o.remove(),this.options.after_close.call(this),this.scope.is_open=!1},this.options.after_callback_delay),this.modaalOverlay("hide"),this.lastFocus)&&this.lastFocus.focus()}watchEvents(){this.dom.removeEventListener("click",this.clickHandler),this.dom.removeEventListener("keyup",this.keyupHandler),this.dom.removeEventListener("keydown",this.keydownHandler),this.keydownHandler=t=>{var e;9===t.keyCode&&this.scope.is_open&&(e=document.getElementById(this.scope.id))&&!e.contains(t.target)&&(t=e.querySelector('[tabindex="0"]'))&&t.focus()},this.keyupHandler=t=>{var e,o;if(t.shiftKey&&9===t.keyCode&&this.scope.is_open&&(e=document.getElementById(this.scope.id))&&!e.contains(t.target)&&(e=e.querySelector(".modaal-close"))&&e.focus(),!this.options.is_locked&&27===t.keyCode&&this.scope.is_open)return document.activeElement.matches('input:not([type="checkbox"]):not([type="radio"])')?void 0:void this.close();"image"===this.options.type&&(e=document.getElementById(this.scope.id),37===t.keyCode&&this.scope.is_open&&(o=e?.querySelector(".modaal-gallery-prev"))&&!o.classList.contains("is_hidden")&&this.galleryUpdate("prev"),39===t.keyCode)&&this.scope.is_open&&(o=e?.querySelector(".modaal-gallery-next"))&&!o.classList.contains("is_hidden")&&this.galleryUpdate("next")},this.clickHandler=t=>{t=t.target;!this.options.is_locked&&(this.options.overlay_close&&t.classList.contains("modaal-inner-wrapper")||t.classList.contains("modaal-close")||t.closest(".modaal-close"))?this.close():t.classList.contains("modaal-confirm-btn")?(t.classList.contains("modaal-ok")&&this.options.confirm_callback.call(this,this.lastFocus),t.classList.contains("modaal-cancel")&&this.options.confirm_cancel_callback.call(this,this.lastFocus),this.close()):t.classList.contains("modaal-gallery-control")&&!t.classList.contains("is_hidden")&&(t.classList.contains("modaal-gallery-prev")&&this.galleryUpdate("prev"),t.classList.contains("modaal-gallery-next"))&&this.galleryUpdate("next")},this.dom.addEventListener("keydown",this.keydownHandler),this.dom.addEventListener("keyup",this.keyupHandler),this.dom.addEventListener("click",this.clickHandler)}buildModal(t,e=!1){var o="instagram"===this.options.type?" modaal-instagram":"",i="video"===this.options.type?"modaal-video-wrap":"modaal-content";let s=" modaal-start_none";"fade"===this.options.animation?s=" modaal-start_fade":"slide-down"===this.options.animation&&(s=" modaal-start_slidedown");var a=this.options.fullscreen?" modaal-fullscreen":"",n=this.options.custom_class?" "+this.options.custom_class:"";let l="";this.options.width&&this.options.height&&"number"==typeof this.options.width&&"number"==typeof this.options.height?l=` style="max-width:${this.options.width}px;height:${this.options.height}px;overflow:auto;"`:this.options.width&&"number"==typeof this.options.width?l=` style="max-width:${this.options.width}px;"`:this.options.height&&"number"==typeof this.options.height&&(l=` style="height:${this.options.height}px;overflow:auto;"`),(["image","video","instagram"].includes(this.options.type)||this.options.fullscreen)&&(l="");var c=this.isTouch()?' style="cursor:pointer;"':"";let d=`<div class="modaal-wrapper modaal-${this.options.type}${s}${o}${a}${n}" id="${this.scope.id}">
			<div class="modaal-outer-wrapper">
				<div class="modaal-inner-wrapper"${c}>`;if("video"!==this.options.type&&(d+=`<div class="modaal-container"${l}>`),d+=`<div class="${i} modaal-focus" aria-hidden="false" aria-label="${this.options.accessible_title} - ${this.options.close_aria_label}" role="dialog">`,"inline"===this.options.type?d+='<div class="modaal-content-container" role="document"></div>':d+=t,d+="</div>"+this.scope.close_btn,"video"!==this.options.type&&(d+="</div>"),d+="</div>","image"===this.options.type&&this.options.outer_controls&&(d+=this.scope.prev_btn+this.scope.next_btn),d+="</div></div>",document.getElementById(this.scope.id+"_overlay")||this.dom.insertAdjacentHTML("beforeend",d),"inline"===this.options.type){var r=document.querySelector(`#${this.scope.id} .modaal-content-container`);if(e){if("string"==typeof t)r.innerHTML=t;else if(t instanceof Element)for(;t.firstChild;)r.appendChild(t.firstChild)}else{var h=document.querySelector(this.scope.source);if(h&&r)for(;h.firstChild;)r.appendChild(h.firstChild)}}this.modaalOverlay("show")}createBasic(){let t="",e=!1;var o,i;"function"==typeof this.scope.source?(o=this.scope.source(),t="string"==typeof o?((i=document.createElement("div")).innerHTML=o,i):o,e=!0):(i=document.querySelector(this.scope.source),t=i||"Content could not be loaded. Please check the source and try again."),this.buildModal(t,e)}createConfirm(){var t=`<div class="modaal-content-container">
			<h1 id="modaal-title">${this.options.confirm_title}</h1>
			<div class="modaal-confirm-content">${this.options.confirm_content}</div>
			<div class="modaal-confirm-wrap">
				<button type="button" class="modaal-confirm-btn modaal-ok" aria-label="Confirm">${this.options.confirm_button_text}</button>
				<button type="button" class="modaal-confirm-btn modaal-cancel" aria-label="Cancel">${this.options.confirm_cancel_button_text}</button>
			</div>
		</div>`;this.buildModal(t)}createImage(){this.buildModal('<div class="modaal-gallery-item is_active" aria-label="Image">Image content</div>')}createVideo(t){this.buildModal(`<div class="modaal-video-container">${`<iframe src="${t}" class="modaal-video-frame" frameborder="0" allowfullscreen></iframe>`}</div>`)}createIframe(t){let e;e=this.options.width&&this.options.height?`<iframe src="${t}" class="modaal-iframe-elem" frameborder="0" allowfullscreen></iframe>`:'<div class="modaal-content-container">Please specify a width and height for your iframe</div>',this.buildModal(e)}createInstagram(){this.buildModal(`<div class="modaal-content-container ${this.options.loading_class}">${this.options.loading_content}</div>`);var t=document.querySelector(`#${this.scope.id} .modaal-content-container`);t&&(t.classList.remove(this.options.loading_class),t.classList.add(this.options.ajax_error_class),t.innerHTML="Instagram photo couldn't be loaded, please check the embed code and try again.")}fetchAjax(t){null===this.options.accessible_title&&(this.options.accessible_title="Dialog Window"),this.xhr&&(this.xhr.abort(),this.xhr=null),this.buildModal(`<div class="modaal-content-container ${this.options.loading_class}">${this.options.loading_content}</div>`),this.xhr=new XMLHttpRequest,this.xhr.open("GET",t,!0),this.xhr.onload=()=>{var t;200<=this.xhr.status&&this.xhr.status<400?(t=document.querySelector(`#${this.scope.id} .modaal-content-container`))&&(t.classList.remove(this.options.loading_class),t.innerHTML=this.xhr.responseText,this.options.ajax_success.call(this,t)):this.handleAjaxError()},this.xhr.onerror=()=>this.handleAjaxError(),this.xhr.send()}handleAjaxError(){var t=document.querySelector(`#${this.scope.id} .modaal-content-container`);t&&(t.classList.remove(this.options.loading_class),t.classList.add(this.options.ajax_error_class),t.innerHTML="Content could not be loaded. Please check the source and try again.")}galleryUpdate(t){console.log("Gallery update:",t)}modaalOpen(){let e=document.getElementById(this.scope.id);if(e){"none"===this.options.animation?(e.classList.remove("modaal-start_none"),this.options.after_open.call(this,e)):"fade"===this.options.animation?e.classList.remove("modaal-start_fade"):"slide-down"===this.options.animation&&e.classList.remove("modaal-start_slidedown"),document.querySelectorAll('.modaal-wrapper *[tabindex="0"]').forEach(t=>{t.removeAttribute("tabindex")});let t=e.querySelector(".modaal-focus");"image"===this.options.type?t=e.querySelector(".modaal-gallery-item."+this.privateOptions.active_class):e.querySelector(".modaal-iframe-elem")?t=e.querySelector(".modaal-iframe-elem"):e.querySelector(".modaal-video-wrap")&&(t=e.querySelector(".modaal-video-wrap")),t&&(t.setAttribute("tabindex","0"),t.focus()),"none"!==this.options.animation&&setTimeout(()=>{this.options.after_open.call(this,e)},this.options.after_callback_delay)}}modaalOverlay(t){var e;if("show"===t)this.scope.is_open=!0,this.options.background_scroll||this.dom.classList.add("modaal-noscroll"),document.getElementById(this.scope.id+"_overlay")||((e=document.createElement("div")).className="modaal-overlay",e.id=this.scope.id+"_overlay",e.style.background=this.options.background,e.style.opacity="0",this.dom.appendChild(e),e.offsetHeight,this.animateOpacity(e,0,this.options.overlay_opacity,this.options.animation_speed,()=>{this.modaalOpen()}));else if("hide"===t){let t=document.getElementById(this.scope.id+"_overlay");t&&this.animateOpacity(t,parseFloat(t.style.opacity),0,this.options.animation_speed,()=>{t.remove(),this.dom.classList.remove("modaal-noscroll")})}}animateOpacity(e,o,i,s,a){let n=performance.now(),l=t=>{t-=n,t=Math.min(t/s,1);e.style.opacity=o+(i-o)*t,t<1?requestAnimationFrame(l):a&&a()};requestAnimationFrame(l)}isTouch(){return"ontouchstart"in window||0<navigator.maxTouchPoints}static defaults={type:"inline",content_source:null,animation:"fade",animation_speed:300,after_callback_delay:350,is_locked:!1,hide_close:!1,background:"#000",overlay_opacity:.8,overlay_close:!0,accessible_title:"Dialog Window",start_open:!1,fullscreen:!1,custom_class:"",background_scroll:!1,should_open:!0,close_text:"Close",close_aria_label:"Close (Press escape to close)",width:null,height:null,before_open:function(){},after_open:function(){},before_close:function(){},after_close:function(){},source:function(t,e){return e},confirm_button_text:"Confirm",confirm_cancel_button_text:"Cancel",confirm_title:"Confirm Title",confirm_content:"<p>This is the default confirm dialog content.</p>",confirm_callback:function(){},confirm_cancel_callback:function(){},gallery_active_class:"gallery_active_item",outer_controls:!1,before_image_change:function(t,e){},after_image_change:function(t){},loading_content:'<div class="modaal-loading-spinner"><div><div></div></div><div><div></div></div><div><div></div></div><div><div></div></div><div><div></div></div><div><div></div></div><div><div></div></div><div><div></div></div></div>',loading_class:"is_loading",ajax_error_class:"modaal-error",ajax_success:function(){},instagram_id:null}}"undefined"!=typeof module&&module.exports&&(module.exports=Modaal),"undefined"!=typeof window&&(window.Modaal=Modaal);